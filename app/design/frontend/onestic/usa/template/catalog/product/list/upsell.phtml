<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2006-2017 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php if(count($this->getItemCollection()->getItems())): ?>
<div class="products-grid box-collateral box-up-sell">
    <h2><?php echo $this->__('Produtos Relacionados') ?></h2>
    <?php // $this->setColumnCount(); // uncomment this line if you want to have another number of columns. also can be changed in layout ?>
    <?php $this->resetItemsIterator() ?>
    <?php for($_i=0;$_i<$this->getRowCount();$_i++): ?>
        <ul class="upsell-slide">
        <?php for($_j=0;$_j<$this->getColumnCount();$_j++): ?>
            <?php if($_link=$this->getIterableItem()): ?>
            <li>
                <?php
                    $price = $_link->getData('price');
                    $price_final = $_link->getData('final_price');
                    $_discountPercentage = round((($price-$price_final)/$price)*100);
                ?>
                <?php $categoryIds = $_link->getCategoryIds(); ?>
                <?php if(in_array(2354, $categoryIds)){  ?>
                    <div class="frete_gratis_icon">FRETE GR√ÅTIS</div>
                <?php } ?>
                <?php if($_discountPercentage > 0){  ?>
                    <div class="desconto_icon"><?php echo '' . $_discountPercentage . '%' ?></div>
                <?php }else{ ?>
                    <div style="background-color:#fff;font-size:0;" class="desconto_icon"><?php echo '-' . $_discountPercentage . '%' ?></div>
                <?php } ?>

                <!-- Imagem -->
                <?php $_categoryIds = $_link->getCategoryIds(); ?>
                <?php $_imgSize = 300; ?>
                <a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_link, 'small_image'), null, true) ?>" class="product-image">
                    <?php if (in_array(26, $_categoryIds)): ?>
                        <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('medicamento-sem-imagem-controlados')->toHtml(); ?>
                    <?php elseif(in_array(295, $_categoryIds)): ?>
                        <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('medicamento-sem-imagem-antimicrobianos')->toHtml(); ?>
                    <?php elseif(in_array(14, $_categoryIds) && in_array(28, $_categoryIds)): ?>
                        <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('medicamento-sem-imagem-genericos')->toHtml(); ?>
                    <?php elseif(in_array(28, $_categoryIds)): ?>
                        <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('medicamento-sem-imagem')->toHtml(); ?>
                    <?php else: ?>
                        <img id="product-collection-image-<?php echo $_link->getId(); ?>"
                             src="<?php echo $this->helper('catalog/image')->init($_link, 'small_image')->resize(125); ?>"
                             alt="<?php echo $this->stripTags($this->getImageLabel($_link, 'small_image'), null, true) ?>" />
                    <?php endif; ?>
                </a>

                <h3 class="product-name"><a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->escapeHtml($_link->getName()) ?>"><?php echo $this->escapeHtml($_link->getName()) ?></a></h3>
                <?php if ($_link->getTypeId() != "configurable") : ?>
                    <span class="product-sku">SKU: <?php echo $_link->getSku(); ?></span><br>
                <?php endif; ?>
                <?php echo $this->getPriceHtml($_link, true, '-upsell') ?>
                
                <?php echo $this->getReviewsSummaryHtml($_link) ?>
                <div class="actions">
                    <?php if($_link->isSaleable()): ?>
                        <button type="button" title="<?php echo Mage::helper('core')->quoteEscape($this->__('Add to Cart')) ?>" class="button btn-cart" onclick="setLocation('<?php echo $this->getAddToCartUrl($_link) ?>')"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button>
                    <?php else: ?>
                        <p class="availability out-of-stock"><span><?php echo $this->__('Out of stock') ?></span></p>
                    <?php endif; ?>
                    <ul class="add-to-links">
                        <?php if ($this->helper('wishlist')->isAllow()) : ?>
                            <li><a href="<?php echo $this->helper('wishlist')->getAddUrl($_link) ?>" class="link-wishlist"><?php echo $this->__('Add to Wishlist') ?></a></li>
                        <?php endif; ?>
                        <?php if($_compareUrl=$this->getAddToCompareUrl($_link)): ?>
                            <li><span class="separator">|</span> <a href="<?php echo $_compareUrl ?>" class="link-compare"><?php echo $this->__('Add to Compare') ?></a></li>
                        <?php endif; ?>
                    </ul>
                </div>
            </li>
            <?php else: ?>
            <td class="empty">&nbsp;</td>
            <?php endif; ?>
        <?php endfor; ?>
        </ul>
    <?php endfor; ?>
    <script type="text/javascript">decorateTable('upsell-product-table')</script>
    <script type="text/javascript">
        var jQuery = jQuery.noConflict()
        var slider = jQuery(".upsell-slide");
        slider.slick({
            initialSlide: 0,
            slidesToShow: 4,
            slidesToScroll: 1,
            autoplay: true,
            infinite: true
        });
    </script>
</div>
<?php endif ?>
