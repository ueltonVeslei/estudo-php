<?php
/**
 * Uecommerce
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Uecommerce EULA.
 * It is also available through the world-wide-web at this URL:
 * http://www.uecommerce.com.br/
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade the extension
 * to newer versions in the future. If you wish to customize the extension
 * for your needs please refer to http://www.uecommerce.com.br/ for more information
 *
 * @category   Uecommerce
 * @package    Uecommerce_Mundipagg
 * @copyright  Copyright (c) 2012 Uecommerce (http://www.uecommerce.com.br/)
 * @license    http://www.uecommerce.com.br/
 */

/**
 * Mundipagg Payment module
 *
 * @category   Uecommerce
 * @package    Uecommerce_Mundipagg
 * @author     Uecommerce Dev Team
 */

//Return Standard model
$standard = $this->getStandard();

// Get Quote
$quote = $standard->getQuote();

$installmentsHelper = Mage::helper('mundipagg/installments');

if($quote->isVirtual()) {
	$data = $quote->getBillingAddress();
} else {
	$data = $quote->getShippingAddress();
}

$orderGrandTotal = $data->getBaseGrandTotal();

// Partial payment?
$isPartial = Mage::getSingleton('checkout/session')->getApprovalRequestSuccess();

if($isPartial == 'partial'): 
	$authorizedAmount = Mage::getSingleton('checkout/session')->getAuthorizedAmount();

	$baseGrandTotal = $orderGrandTotal - $authorizedAmount;
else :
	$baseGrandTotal = $data->getBaseGrandTotal();
endif;

if($data->getMundipaggInterest()) {
    $baseGrandTotal = $baseGrandTotal-$data->getMundipaggInterest();
}

// We check if taxvat is enabled
$_taxvat = $this->getLayout()->createBlock('customer/widget_taxvat');

// Get current currency symbol
$currencySymbol = Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol();

//Credit Card Saved On File
$ccs = $this->getCcs();

$countCcs = count($ccs);

// Payment method
$_code = $this->getMethodCode();
?>

<fieldset class="form-list">
	<ul id="payment_form_<?php echo $_code ?>" style="display:none;">
		<div>
    		<input type="hidden" id="baseGrandTotal" name="baseGrandTotal" value="<?php echo number_format($baseGrandTotal, "2", ",", ""); ?>"/>
    		<?php if ($isPartial == 'partial'): ?>
    			<input type="hidden" name="partial" id="partial" value="1"/>
				<input type="hidden" name="payment[multi]" id="multi" value="1"/>
			<?php endif; ?>
    	</div>
        <?php 
		// START CREDIT CARD PAYMENT METHOD
    	$num = 1;

    	switch ($_code):
    		case 'mundipagg_creditcardoneinstallment':
    			$num = 1;
    			$paymentMethod = '1CreditCardsOneInstallment';
    			$paymentMethodLabel = $this->__('Credit Card');
    			break;

    		case 'mundipagg_creditcard':
    			$num = 1;
    			$paymentMethod = '1CreditCards';
    			$paymentMethodLabel = $this->__('Credit Card');
    			break;
    		
    		case 'mundipagg_twocreditcards':
    			$num = 2;
    			$paymentMethod = '2CreditCards';
    			$paymentMethodLabel = $this->__('Pay with 2 Credit Cards');
    			break;

    		case 'mundipagg_threecreditcards':
    			$num = 3;
    			$paymentMethod = '3CreditCards';
    			$paymentMethodLabel = $this->__('Pay with 3 Credit Cards');
    			break;

    		case 'mundipagg_fourcreditcards':
    			$num = 4;
    			$paymentMethod = '4CreditCards';
    			$paymentMethodLabel = $this->__('Pay with 4 Credit Cards');
    			break;

    		case 'mundipagg_fivecreditcards':
    			$num = 5;
    			$paymentMethod = '5CreditCards';
    			$paymentMethodLabel = $this->__('Pay with 5 Credit Cards');
    			break;
    	endswitch;
    	?>
       	<li>
        	<div id="<?php echo $_code; ?>">
        		<?php if($num != 1 && $isPartial != 'partial'): ?>
    				<p></p>
    				<div>
    					<b><?php echo $this->__('Grand Total') ?>:</b> <?php echo $currencySymbol.number_format($baseGrandTotal, "2", ",", "."); ?>
    				</div>
    				<p></p>
    			<?php endif ?>
    			<?php if ( $_code == 'mundipagg_creditcardoneinstallment' || $_code == 'mundipagg_creditcard' || $_code == 'mundipagg_twocreditcards' || $_code == 'mundipagg_threecreditcards' || $_code == 'mundipagg_fourcreditcards' || $_code == 'mundipagg_fivecreditcards'): ?>
	                <ul>
	                	<?php for($c=1;$c<=$num;$c++): ?>
	                		<input type="hidden" id="mundipagg_type" name="payment[mundipagg_type]" value="<?php echo $paymentMethod ; ?>"/>
                            <?php $currentSelectedToken = null; ?>
	            			<?php if($countCcs > 0 ):?>
	                    		<li class="fields" style="margin-bottom: 5px;">
	                    			<div class="field">
	                    				<label class="required"><?php echo $this->__('Select a Credit Card or add a new one') ?><span class="required">*</span></label>
		                    			<div class="input-box">

				                    		<select id="<?php echo $_code; ?>_token_<?php echo $num; ?>_<?php echo $c;?>" data="group_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_token_<?php echo $num; ?>_<?php echo $c;?>]" class="required-entry tokens group_<?php echo $num; ?>_<?php echo $c;?>" onchange="token_or_not(<?php echo $num; ?>,<?php echo $c;?>,this)">
				                    			<option value="">...</option>
					                    		<?php
					                    		$selected = '';
					                    		
					                    		if($countCcs == 1):
					                    			$selected = 'selected="selected"';
					                    		endif;

												foreach($ccs as $id => $cc):

                                                    if($countCcs == 1){
                                                        $currentSelectedToken = Mage::getSingleton('mundipagg/source_cctypes')->getCcTypeForLabel($cc->getCcType());
                                                    }
                                                    $dataType = $currentSelectedToken?$currentSelectedToken:Mage::getSingleton('mundipagg/source_cctypes')->getCcTypeForLabel($cc->getCcType());
													echo '<option value="'.$cc->getId().'" '.$selected.' data="'.$dataType.'">'.$cc->getCcType().' '.$cc->getCreditCardMask().'</option>';
												endforeach;
												?>
												<option value="new"><?php echo $this->__('New Credit Card') ?></option>
											</select>
										</div>
									</div>
								</li>
								<?php if($num != 1): ?>
									<div id="value_<?php echo $num; ?>_<?php echo $c;?>">
			                        	<li class="fields" style="margin-bottom: 5px;">
			                        		<div class="field">
			                        			<label class="required"><?php echo $this->__('Value (Ex: 100,50)') ?> <span class="required">*</span></label>
									        	<div class="input-box">	
									        		<input type="text" id="<?php echo $_code; ?>_value_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_value_<?php echo $num; ?>_<?php echo $c;?>]" title="<?php echo $this->__('Value (Ex: 100,50)') ?>" class="required-entry input-text validate-greater-than-zero check_values group_<?php echo $num; ?>_<?php echo $c;?>" onchange="calculateInstallmentValue(this, <?php echo $num;?>, <?php echo $c;?>, '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>');" onkeydown="remove_special_characters(event);" value=""/>
									        	</div>
									        </div>
								        </li>
								    </div>
							    <?php endif; ?>
								<?php if ($installmentsHelper->isInstallmentsEnabled() && $_code != 'mundipagg_creditcardoneinstallment'): ?>
									<div id="parcelamento_<?php echo $num; ?>_<?php echo $c;?>" <?php if($countCcs > 1): ?>style="display:none"<?php endif?>>
		                                <li class="fields" style="margin-bottom: 5px;">
		                                	<div class="field">
		                                		<label class="required"><?php echo $this->__('Credit options') ?> <?php if($num == 2):?><!--<a href="javascript:void(0);" onclick="javascript:void(0);">(<?php /*echo $this->__('click to update') */?>)</a>--><?php endif ?></label>
			                                	<div class="input-box">
			                                		<select id="<?php echo $_code; ?>_credito_parcelamento_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_credito_parcelamento_<?php echo $num; ?>_<?php echo $c;?>]" class="required-entry installment-token group_<?php echo $num; ?>_<?php echo $c;?>" onchange="checkInstallments(this, '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>');">
					                                	<?php foreach($this->getInstallments($currentSelectedToken) as $key => $parcel): ?>
															<option value="<?php echo $key ?>"><?php echo $parcel ?></option>
														<?php endforeach ?>
			                                		</select>
				                           		</div>
				                           	</div>
		                        		</li>
	                    			</div>
	    						<?php endif; ?>
	    					<?php endif; ?>
							<div id="<?php echo $_code; ?>_new_credit_card_<?php echo $num; ?>_<?php echo $c;?>" <?php if( $countCcs > 0 ) { ?>style="display:none"<?php } ?>>
							
	                        	<li style="margin-bottom: 5px;">
	                        		<div class="field">
	                        			<label class="required"><?php echo $this->__('Credit Card Issuer') ?> <span class="required">*</span></label>
		                        		<div class="input-box">
									        <ul class="inline input-radio">
									        <?php 
									        $ccards = $standard->getCcTypes();
									        $_i = 1;
									        ?>
									            <?php foreach($ccards as $ccard): ?>
									            	<li class="cc_brands">
                                                        <div class="cc_brand_types <?php echo strtolower($ccard); ?>">&nbsp;</div>
														<!--<img src="<?php //echo $this->getSkinUrl('images/mundipagg/'.$ccard.'.png');?>" alt="<?php //echo $ccard ?>" border="0" class="cursor_hand" onclick="setCcType(this, '<?php //echo $_code; ?>', '<?php //echo $num; ?>', '<?php //echo $c;?>', '<?php //echo $ccard; ?>');">-->
														<input type="radio" name="payment[<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_credito_instituicao]" id="<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_credito_instituicao_<?php echo $ccard; ?>" value="<?php echo $ccard ?>" class="<?php if ($_i == 1): ?>validate-one-required-by-name<?php endif; ?>" onclick="setCcType(this, '<?php echo $_code; ?>', '<?php echo $num; ?>', '<?php echo $c;?>', '<?php echo $ccard; ?>');">
													</li>
									            <?php 
									            $_i++;
									            endforeach 
									            ?>
								        	</ul>
                                                            <p class="info-payment"><i><small><?php echo $this->__('The flag is automatically selected after entering the credit card number below.'); ?></small></i></p>
								        	<input type="hidden" name="payment[<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_cc_type]" id="<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_cc_type" value="" class="validate-cc-type-select"/>
										</div>
									</div>
	                    		</li>
	                    		<li style="margin-bottom: 5px;">
	                    			<div class="field">
	                    				<label class="required"><?php echo $this->__('Credit Card Number') ?> <span class="required">*</span></label>
				                    	<div class="input-box">
				                    		<input type="text" id="<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_cc_number" name="payment[<?php echo $_code; ?>_<?php echo $num; ?>_<?php echo $c;?>_cc_number]" title="<?php echo $this->__('Credit Card Number') ?>" class="input-text required-entry itaucard-only selecionabandeirajs" onkeydown="remove_characters(event);" value=""/>
				                    	</div>
				                    </div>
	                			</li>
	                        	<li style="margin-bottom: 5px;">
	                        		<div class="field">
	                        			<label class="required"><?php echo $this->__('Credit Card Holder name') ?> <span class="required">*</span></label>
		                                <div class="input-box">
		                                    <input type="text" id="<?php echo $_code; ?>_cc_holder_name_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_cc_holder_name_<?php echo $num; ?>_<?php echo $c;?>]" class="required-entry input-text" />
		                                </div>
	                            	</div>
	                    		</li>
			                    <li style="margin-bottom: 5px;">
			                    	<div class="field">
			                    		<label class="required"><?php echo $this->__('Expiration date') ?> <span class="required">*</span></label>
				                   		<div class="input-box">
											<div class="v-fix">
												<select id="<?php echo $_code; ?>_expirationMonth_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_expirationMonth_<?php echo $num; ?>_<?php echo $c;?>]" class="month required-entry validate-cc-exp-new">
				                                    <option value=""><?php echo $this->__('Month') ?></option>
				                                    <option value="1">01 - <?php echo $this->__('January') ?></option>
				                                    <option value="2">02 - <?php echo $this->__('February') ?></option>
				                                    <option value="3">03 - <?php echo $this->__('March') ?></option>
				                                    <option value="4">04 - <?php echo $this->__('April') ?></option>
				                                    <option value="5">05 - <?php echo $this->__('May') ?></option>
				                                    <option value="6">06 - <?php echo $this->__('June') ?></option>
				                                    <option value="7">07 - <?php echo $this->__('July') ?></option>
				                                    <option value="8">08 - <?php echo $this->__('August') ?></option>
				                                    <option value="9">09 - <?php echo $this->__('September') ?></option>
				                                    <option value="10">10 - <?php echo $this->__('October') ?></option>
				                                    <option value="11">11 - <?php echo $this->__('November') ?></option>
				                                    <option value="12">12 - <?php echo $this->__('December') ?></option>
			                                	</select>
			                                </div>
			                                <div class="v-fix" style="padding-left:6px;">
			                                	<select id="<?php echo $_code; ?>_expirationYear_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_expirationYear_<?php echo $num; ?>_<?php echo $c;?>]" class="year required-entry">
				                                    <option value=""><?php echo $this->__('Year') ?></option>
				                                    <?php 
				                                    $i = date('Y');
				                                    $year = date('Y');
				                                    $year10 = $year + 10;
				                                    for( $i = $year; $i <= $year10; $i++ ):
				                                    ?>
				                                    	<option value="<?php echo substr($i, -2);?>"><?php echo $i;?></option>
				                                    <?php endfor; ?>
			                                	</select>
			                                </div>
			                            </div>
				                	</div>
				                </li>
			                    <li style="margin-bottom: 5px;">
			                    	<div class="field">
			                    		<label class="required"><?php echo $this->__('Card Verification Number') ?> <span class="required">*</span></label>
				                    	<div class="input-box">
					                    	<div class="v-fix">
					                    		<input type="text" id="<?php echo $_code; ?>_cc_cid_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_cc_cid_<?php echo $num; ?>_<?php echo $c;?>]" style="width: 55px" class="required-entry input-text validate-cc-cvn validate-length" maxlength="4" onkeydown="remove_characters(event);"/>
					                    	</div>
					                    	<div class="v-fix" style="padding-left:6px;">
					                    		<a href="#" class="cvv-what-is-this"><?php echo $this->__('What is this?') ?></a>
					                    	</div>
										</div>
									</div>
								</li>
								<?php if($num != 1): ?>
		                        	<li style="margin-bottom: 5px;">
						        		<div class="field">
						        			<label class="required"><?php echo $this->__('Value (Ex: 100,50)') ?> <span class="required">*</span></label>
						        			<div class="input-box">
						        				<input type="text" id="<?php echo $_code; ?>_new_value_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_new_value_<?php echo $num; ?>_<?php echo $c;?>]" title="<?php echo $this->__('Value (Ex: 100,50)') ?>" class="required-entry validate-greater-than-zero check_values input-text" onchange="calculateInstallmentValue(this, <?php echo $num;?>, <?php echo $c;?>, '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>');" onkeydown="remove_special_characters(event);" value=""/>
						        			</div>
						        		</div>
							        </li>
							    <?php endif; ?>
                                <?php if ($installmentsHelper->isInstallmentsEnabled() && $_code != 'mundipagg_creditcardoneinstallment'): ?>
	                                <li style="margin-bottom: 5px;">
	                                	<div class="field">
	                                		<label class="required"><?php echo $this->__('Credit options') ?> <?php if($num ==2): ?><!--<a href="javascript:void(0);" onclick="javascript:void(0);">(<?php /*echo $this->__('click to update') */?>)</a>--><?php endif ?></label>
		                                	<div class="input-box">
		                                		<select id="<?php echo $_code; ?>_new_credito_parcelamento_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_new_credito_parcelamento_<?php echo $num; ?>_<?php echo $c;?>]" onchange="checkInstallments(this, '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>');">
													<?php foreach($this->getInstallments() as $key => $parcel): ?>
													<option value="<?php echo $key ?>"><?php echo $parcel ?></option>
													<?php endforeach ?>
												</select>
			                           		</div> 
			                           	</div>
	                        		</li>
	            				<?php endif; ?>
	            				<?php if ($standard->getConfigData('clearsale') && !$_taxvat->isEnabled()): ?>
		        					<li style="margin-bottom: 5px;">
		        						<div class="field">
		        							<label class="required"><?php echo $this->__('CPF ou CNPJ') ?> <span class="required">*</span></label>
								        	<div class="input-box">
								        		<input type="text" id="<?php echo $_code; ?>_cc_taxvat_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_cc_taxvat_<?php echo $num; ?>_<?php echo $c;?>]" title="<?php echo $this->__('CPF ou CNPJ') ?>" class="validar_cpf required-entry" onkeydown="remove_characters(event);"/>
								        	</div>
								        </div>
							        </li>
						    	<?php endif;?>
						    	<?php if($standard->getQuote()->getCheckoutMethod() != 'guest'): ?>
                                                                <?php if(Mage::getStoreConfig('payment/mundipagg_standard/save_cardonfile')): ?>
						    	<li>
                                                        
		               				<div class="input-box" style="padding-top: 10px">
		               					<div class="field">
		                        			<label class="required"><?php echo $this->__('Save Card On File') ?></label> 
		                        			<input type="checkbox" id="<?php echo $_code; ?>_save_token_<?php echo $num; ?>_<?php echo $c;?>" name="payment[<?php echo $_code; ?>_save_token_<?php echo $num; ?>_<?php echo $c;?>]" value="new"/>
		                        		</div>
                                                        
		                        	</div>
		                        </li>
                                        <?php endif; ?>
		                    	<?php endif; ?>
					    	</div>
					    <?php endfor; ?> 
	                </ul>
	            <?php endif ?>
            </div>
        </li> 
    	<?php // END CREDIT CARD PAYMENT METHOD ?>
	</ul>
</fieldset>

<script type="text/javascript">
//<![CDATA[
Validation.addAllThese([
	['validate-cc-exp-new', '<?php echo $this->jsQuoteEscape( Mage::helper('mundipagg')->__('Incorrect credit card expiration date.') )?>', function(v, elm) {
        var ccExpMonth   = v;
        var ccExpYear    = $( elm.id.replace("_expirationMonth", "_expirationYear") ).value;

        var currentTime  = new Date();
        var currentMonth = currentTime.getMonth() + 1;
        var currentYear  = currentTime.getFullYear().toString().substr(2,2);
        if (ccExpMonth < currentMonth && ccExpYear == currentYear) {
            return false;
        }
        return true;
    }],
    ['itaucard-only', 'Esta loja só aceita cartões Itaucard', function(v, elm) {
        if (/^(543960|459455|544507|459457|544169|459458|544507|459457|527616|459454|553665|482447|490172|490172|549167|490172|549167|549167|490172|403247|544859|490172|403247|514868|490172|514868|514868|553636|477176|552072|515640|523432|414505|519699|414504|523431|414506|411049|518613|515765|516070|525661|526769|526788|530073|530148|545462|222661|222662|510089|512215|512363|512374|512461|512658|512673|513728|513731|514090|514568|514868|514898|514945|515640|515743|515836|516164|516275|516283|516291|516306|517858|517967|518020|518054|518138|518218|518306|518307|518328|518491|518950|518984|518995|520196|520199|520404|520977|521039|521042|521043|521397|522027|522446|522949|522979|523284|523431|523432|524003|524314|524474|524703|524820|525496|525662|525663|525664|525695|525718|526863|526892|527036|527468|527495|527496|527497|527532|527533|527538|527539|527543|527544|527616|527887|527889|528941|529285|529323|530049|530452|530599|530996|531681|531705|533914|534249|534447|534448|536804|536956|539039|539059|539083|540508|540631|540755|540760|541187|541555|541759|542510|542622|542711|542974|542976|542982|543051|543095|543391|543559|543960|544169|544199|544300|544507|544540|544547|544554|544560|544570|544599|544654|544665|544839|544859|544883|545670|545719|545768|545780|545810|545823|545832|545850|545967|546056|546460|546461|546559|546744|546754|547468|548295|548296|548337|548474|548723|548724|548984|548985|549167|549339|549359|549383|549585|552072|552236|552317|552640|552914|553624|553636|553665|553666|554282|554309|554480|554613|554722|554774|554775|555047|556615|556616|556673|558303|559089|548639|508116|514201|519810|539028|544828|549328|552128|552297|510426|222663|515740|515741|515742|515802|520402|520403|520405|520621|525320|526762|527405|527407|527425|527430|531249|539090|539091|544890|544891|549390|549391|552697|517914|518967|530780|530994|222664|528392|528860|523791|527010|527018|554563|554587|531449|606282|637095|520400|520401|527467|530038|534503|534513|534516|534562|534571|535081|535085|535088|535091|535094|535097|535106|535822|535841|535850|535858|535863|535867|535871|536143|539011|539012|539021|539022|539029|539031|539040|539041|539050|539051|539058|539060|539062|539063|539064|539066|539068|539070|539073|539074|539077|539084|539085|541886|544810|544829|544831|544833|544841|544860|544862|544863|544864|544874|544881|549319|549329|549341|549358|549363|549368|552070|554917|230086|637568|230097|637599|637612|230090|637609|513629|513630|513631|533655|533706|542193|543744|543927|543971|544265|544276|544293|544296|544328|544386|544442|544600|544672|544673|545073|545287|545453|545606|545707|545752|545824|545957|545959|546003|546337|548305|548722|548802|548839|230085|637600|545011|548625|548708|548721|543869|544753|545349|545394|548514|549202|549221|545368|546338|544522|546841|230132|230169|230226|230305|230319|230330|511258|519166|519662|230378|230610|230667|679018|402434|402773|402774|405773|405774|405775|405776|405777|405778|405779|416914|457548|482481|482482|400217|400225|400235|400238|400247|400248|400252|400253|400254|400268|400439|400635|400637|400638|400642|400643|400645|400646|400647|400649|400652|400653|400654|400689|400694|401130|401131|401132|401144|401145|401146|401165|401167|401168|401652|401653|402433|402439|403217|403225|403237|403246|403247|403254|404948|405967|405980|406211|406871|407409|407414|407505|407600|407657|409923|410001|410002|410003|410004|411049|411860|411861|412723|413409|414505|414506|415221|416069|416094|417872|417873|417874|417957|417987|417988|418668|420180|421309|421507|421843|421844|421845|421847|421848|422004|422005|422007|422100|422102|422103|422200|422203|422527|423074|423075|424430|431929|432942|432943|432944|434101|434945|438672|438903|439354|439388|439389|439390|439480|439481|440132|441030|444054|446305|449771|450321|451301|452407|456137|456340|456348|456401|457943|459020|459023|459077|459078|459080|459313|459314|459315|459316|459450|459451|459454|459455|459457|459458|460034|460035|460038|463292|463293|463294|463295|463296|463297|463298|463299|464294|464295|464296|464297|464298|464299|464300|464301|465769|467100|467793|469865|469866|469867|469868|470598|472663|472664|472665|472666|472667|472668|472669|473660|473661|473662|474538|477128|477129|477176|478307|478308|478309|478310|482447|482448|482476|482477|482478|482479|483085|483096|483097|483098|483150|483151|485103|485104|485486|486654|489391|489399|489400|489423|489430|489451|435002|435033|435035|489639|490144|490172|491446|491447|491448|493490|498530|498553|498554|498555|498556|400234|400634|403230|421470|421471|422006|422101|422201|477175|418043|418044|421508|421644|421862|421864|422185)/.test(v)){
            return true;
        } else {
            return false;
        }
    }]
]);

window.baseUrl = '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>';
window.installmentsandinterestUrl = '<?php echo Mage::getUrl('mundipagg/standard/installmentsandinterest',array('_secure'=>true)); ?>';
window.ajaxLoaderGif = '<?php echo $this->getSkinUrl('images/mundipagg/ajax-loader.gif'); ?>';
window.isInstallmentsEnabled = '<?php echo Mage::helper('mundipagg/installments')->isInstallmentsEnabled(); ?>';

$$('.selecionabandeirajs').invoke('observe','keyup',function(){
    selectCredcard(this);
});
$$('.selecionabandeirajs').invoke('observe','blur',function(){
    selectCredcard(this);
});
//]]>
</script>